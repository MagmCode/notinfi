<!--
  consulta-definitiva-bcv.component.html
  Vista principal para la consulta definitiva BCV de jornadas de intervención.
  Permite al usuario ingresar el código de jornada y exportar la información asociada.
  Incluye cabecera, formulario de criterios y botones de acción.
-->

<fuse-loading-bar></fuse-loading-bar>

<mat-sidenav-container>
    <!-- Outlet para rutas hijas si aplica -->
    <router-outlet *ngIf="true"></router-outlet>
    <mat-sidenav-content>
        <!-- Contenedor principal de la vista -->
        <div class="main-container bg-white flex flex-col w-full h-full md:w-screen md:h-screen items-center px-2 md:px-0" >
            <!-- Cabecera de la página -->
            <div class="header-container flex justify-between w-3/5 my-10 text-7xl ">
                <span>Consulta BCV Definitiva</span>
                <div class="icon-container flex flex-col items-center mr-40">
                    <!-- Icono representativo -->
                    <mat-icon class="head-icon icon-size-10 icon-bdv-icon-usdbill-l opacity-40 pt-5"></mat-icon>
                    <span class="text-head mt-8">Intervención</span>
                </div>
            </div>
            <!-- Tarjeta principal con el formulario de criterios -->
            <mat-card class="card-container flex flex-col items-center justify-between p-8 rounded-3xl ">
                <div class="card-title">
                    <span>Seleccione Criterios</span>
                </div>
                <!-- Formulario para ingresar el código de jornada -->
                <form class="card-form" [formGroup]="consultaForm">
                    <!-- Campo para el código de jornada -->
                    <mat-form-field class="consulta-input w-full" appearance="outline">
                        <mat-label>Código de Jornada</mat-label>
                        <input id="cod" matInput type="number" formControlName="cod">
                        <mat-hint class="hint font-medium pt-2 pl-7">Introduzca el código de jornada</mat-hint>
                        <!-- Mensaje de error si el campo es inválido -->
                        <mat-error>
                            Campo inválido
                        </mat-error>
                    </mat-form-field>
                </form>
                <!-- Botones de acción: Exportar y Salir -->
                <div class="buttons-container flex justify-center gap-6">
                    <button mat-raised-button class=" w-full px-8 py-0" type="submit" (click)="exportarJornada()" [disabled]="showExportProgress || showExportStart || generandoArchivo">Exportar</ button>
                    <button mat-raised-button class=" w-full px-8 py-0" (click)="inicio()">Salir</button>
                </div>
                <div *ngIf="showExportProgress" class="text-center text-sm text-gray-700 progress">
                    <ng-container *ngIf="!generandoArchivo; else preparandoDescarga">
                        Generando archivo: {{exportProgress}}%
                    </ng-container>
                    <ng-template #preparandoDescarga>
                        {{mensajePreparandoDescarga}}
                    </ng-template>
                </div>
                <div *ngIf="showExportStart" class="text-center text-sm text-gray-700 progress">
                    <ng-container>{{mensajeConexionActual}}</ng-container> 
                </div>
                <mat-progress-bar *ngIf="showExportProgress" mode="determinate" [value]="exportProgress"></mat-progress-bar>
                <mat-progress-bar *ngIf="showExportStart" mode="indeterminate">
                                      
                </mat-progress-bar>
                </mat-card>

        </div>
    </mat-sidenav-content>
</mat-sidenav-container>