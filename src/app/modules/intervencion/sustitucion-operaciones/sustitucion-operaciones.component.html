<!--
  sustitucion-operaciones.component.html
  Vista principal para la carga y procesamiento de archivos de Sustitución de Operaciones.
  Permite al usuario seleccionar un archivo Excel, valida la extensión y muestra mensajes de error.
  Incluye botones para procesar el archivo o salir al menú principal.
-->

<!-- Barra de carga superior (puede mostrar progreso de operaciones globales) -->
<fuse-loading-bar></fuse-loading-bar>

<!-- Contenedor principal con menú lateral y rutas hijas -->
<mat-sidenav-container>
    <!-- Outlet para rutas hijas si aplica -->
    <router-outlet *ngIf="true"></router-outlet>
    <mat-sidenav-content>
        <!-- Contenido principal centrado vertical y horizontalmente -->
        <div class="main-container bg-white flex flex-col justify-center items-center w-screen h-4/5 fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
            
            <!-- Cabecera de la tarjeta principal -->
            <div class="header-container flex justify-between w-3/5 mb-10 text-7xl ">
                <span>Sustitución de Operaciones</span>
                <div class="icon-container flex flex-col items-center mr-30">
                    <!-- Icono representativo -->
                    <mat-icon class="head-icon icon-size-10 icon-bdv-icon-usdbill-l opacity-40 pt-5"></mat-icon>
                    <span class="text-head mt-8">Intervención</span>
                </div>
            </div>

            <!-- Tarjeta principal con el formulario de carga -->
            <mat-card class="card-container flex flex-col items-center justify-between p-8 rounded-3xl">
                <!-- Título de la tarjeta -->
                <div class="card-title">
                    <span>Seleccione Criterios</span>
                </div>

                <!-- Formulario reactivo para la carga de archivos -->
                <form class="card-form" [formGroup]="cargaForm">  
                    <!-- Campo de selección de archivo Excel -->
                    <mat-form-field
                        class="file-browse w-full"
                        appearance="outline"
                        [ngClass]="{'mat-form-field-valid': cargaForm.controls['file'].valid && cargaForm.controls['file'].value}">
                        <mat-label>Archivo</mat-label>
                        <!-- Input de solo lectura que muestra el nombre del archivo seleccionado -->
                        <input
                            id="file"
                            matInput
                            [formControlName]="'file'"  
                            [value]="fileName"
                            readonly>
                        <!-- Mensaje de ayuda para el usuario -->
                        <mat-hint class="mat-hint font-medium pt-2 pl-14">Suba un archivo Excel</mat-hint>
                        <!-- Mensaje de error si no se selecciona archivo -->
                        <mat-error *ngIf="cargaForm.get('file').hasError('required') && cargaForm.get('file').touched">
                            Debe seleccionar un archivo
                        </mat-error>
                        <!-- Mensaje de error si el archivo no es válido -->
                        <mat-error *ngIf="cargaForm.get('file').hasError('invalidFile')">
                            Por favor, sube un archivo Excel válido
                        </mat-error>
                        <!-- Icono para abrir el selector de archivos -->
                        <mat-icon (click)="fileInput.click()" class="icon-bdv-icon-file2-m file-icon"></mat-icon>
                        <!-- Input real de tipo file, oculto, que dispara el evento de selección -->
                        <input type="file" #fileInput (change)="onFileSelected($event)" accept=".xls,.xlsx,.xlsm,.xlsb,.xlt,.xltx,.xltm" hidden>
                    </mat-form-field>
                </form>

                <!-- Botones de acción -->
                <div class="buttons-container flex justify-center gap-6">
                    <!-- Botón para procesar el archivo cargado -->
                    <button class="mat-raised-button w-full px-7 py-0" type="submit" (click)="procesar()">Procesar</button>
                    <!-- Botón para salir y regresar al menú principal -->
                    <button class="mat-raised-button w-full px-8 py-0" (click)="inicio()">Salir</button>
                </div>
            </mat-card>
        </div>
    </mat-sidenav-content>
</mat-sidenav-container>